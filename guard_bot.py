import osimport jsonimport loggingfrom datetime import datetime, timedeltafrom functools import wrapsimport refrom telegram import Update, InlineKeyboardButton, InlineKeyboardMarkupfrom telegram.ext import (    Application, CommandHandler, MessageHandler, CallbackQueryHandler,    filters, ContextTypes)from telegram.constants import ParseMode# ===== KONFIGURASI =====TOKEN = "8300850049:AAF0Phz7PyLXKNwN_6zRUc9bmnsynELQEV8"  # <-- GANTI INI!OWNER_ID = 7732947023  # <-- GANTI DENGAN ID LOLOG_CHANNEL = -1001234567890  # <-- GANTI DENGAN ID CHANNEL LOG (bisa 0 jika tidak pakai)DATA_FILE = "group_data.json"LOG_LEVEL = logging.INFOlogging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=LOG_LEVEL)logger = logging.getLogger(__name__)# ===== MANAJEMEN DATA =====def load_data():    if os.path.exists(DATA_FILE):        with open(DATA_FILE, 'r') as f:            return json.load(f)    return {        "groups": {},        "users": {},        "reminders": []    }def save_data(data):    with open(DATA_FILE, 'w') as f:        json.dump(data, f, indent=2)# ===== DECORATOR ADMIN & OWNER =====def admin_only(func):    @wraps(func)    async def wrapper(update: Update, context: ContextTypes.DEFAULT_TYPE, *args, **kwargs):        user = update.effective_user        chat = update.effective_chat        if not user or not chat:            return        try:            member = await chat.get_member(user.id)            if member.status in ['administrator', 'creator']:                return await func(update, context, *args, **kwargs)            else:                await update.message.reply_text("âŒ *Akses ditolak!* Hanya admin yang bisa menggunakan perintah ini.", parse_mode=ParseMode.MARKDOWN)        except Exception as e:            logger.error(f"Admin check error: {e}")    return wrapperdef owner_only(func):    @wraps(func)    async def wrapper(update: Update, context: ContextTypes.DEFAULT_TYPE, *args, **kwargs):        user = update.effective_user        if user and user.id == OWNER_ID:            return await func(update, context, *args, **kwargs)        else:            await update.message.reply_text("âŒ *Perintah ini hanya untuk owner bot.*", parse_mode=ParseMode.MARKDOWN)            return    return wrapper# ===== FUNGSI LOG =====async def log_action(context: ContextTypes.DEFAULT_TYPE, action: str, user, admin, reason: str = ""):    """Kirim log ke channel khusus"""    if not LOG_CHANNEL or LOG_CHANNEL == 0:        return    try:        text = (            f"ğŸ“‹ **Log Aktivitas**\n\n"            f"ğŸ‘¤ **User:** {user.mention_html()} (`{user.id}`)\n"            f"ğŸ‘® **Admin:** {admin.mention_html()}\n"            f"ğŸ”¨ **Aksi:** {action}\n"        )        if reason:            text += f"ğŸ“ **Alasan:** {reason}\n"        await context.bot.send_message(chat_id=LOG_CHANNEL, text=text, parse_mode=ParseMode.HTML)    except Exception as e:        logger.error(f"Gagal kirim log: {e}")# ===== HANDLER UTAMA =====async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):    keyboard = [        [InlineKeyboardButton("ğŸ“– Bantuan", callback_data="help")],        [InlineKeyboardButton("ğŸ“Š Statistik Grup", callback_data="stats")],        [InlineKeyboardButton("ğŸ› ï¸ Menu Admin", callback_data="admin_menu")],    ]    reply_markup = InlineKeyboardMarkup(keyboard)    await update.message.reply_text(        "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n"        "   ğŸ¤– *Group Guard Bot*  \n"        "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n"        "âœ¨ *Fitur Unggulan:*\n"        "â€¢ ğŸ›¡ï¸ Anti-spam & anti-raid\n"        "â€¢ âš ï¸ Sistem peringatan (3x auto-ban)\n"        "â€¢ ğŸš« Blokir kata & link terlarang\n"        "â€¢ â° Pengingat grup\n"        "â€¢ ğŸ“Š Statistik lengkap\n"        "â€¢ ğŸ” Cek ID anggota\n"        "â€¢ ğŸ“‹ Log aktivitas ke channel\n\n"        "ğŸ‘‘ *Jadikan bot sebagai admin* untuk fitur maksimal.\n"        "Ketik /help untuk lihat semua perintah.",        reply_markup=reply_markup,        parse_mode=ParseMode.MARKDOWN    )async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):    text = (        "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n"        "        ğŸ“š *BANTUAN*        \n"        "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n"        "ğŸ‘®â€â™‚ï¸ *Admin Only:*\n"        "â”œ /kick â€“ Keluarkan anggota\n"        "â”œ /ban â€“ Blokir permanen\n"        "â”œ /unban <id> â€“ Buka blokir\n"        "â”œ /mute [menit] â€“ Bisukan\n"        "â”œ /unmute â€“ Batalkan bisu\n"        "â”œ /warn â€“ Beri peringatan\n"        "â”œ /warns â€“ Cek peringatan user\n"        "â”œ /delwarn â€“ Hapus 1 peringatan\n"        "â”œ /lock â€“ Kunci grup\n"        "â”œ /unlock â€“ Buka grup\n"        "â”œ /antiraid on/off â€“ Proteksi raid\n"        "â”œ /autodelete â€“ Atur kata terlarang\n"        "â”œ /antilink â€“ Atur blokir link\n"        "â”œ /remind â€“ Set pengingat\n"        "â”œ /poll â€“ Buat polling\n"        "â”œ /rep â€“ Tambah reputasi\n"        "â”œ /export â€“ Ekspor data grup\n"        "â”” /settings â€“ Pengaturan\n\n"        "ğŸ‘¤ *Semua Anggota:*\n"        "â”œ /stats â€“ Statistik grup\n"        "â”œ /reputation â€“ Lihat reputasi\n"        "â”œ /id â€“ Cek ID pengguna/chat\n"        "â”” /report â€“ Laporkan masalah\n\n"        "ğŸ’¡ *Tips:* Reply ke pesan untuk kick/ban/mute/warn."    )    await update.message.reply_text(text, parse_mode=ParseMode.MARKDOWN)async def id_command(update: Update, context: ContextTypes.DEFAULT_TYPE):    msg = update.message    if msg.reply_to_message:        user = msg.reply_to_message.from_user        text = (            f"ğŸ†” *User ID:* `{user.id}`\n"            f"ğŸ‘¤ *Nama:* {user.mention_html()}\n"            f"ğŸ“Œ *Username:* @{user.username if user.username else '-'}"        )    else:        user = msg.from_user        chat = msg.chat        text = (            f"ğŸ†” *User ID:* `{user.id}`\n"            f"ğŸ‘¤ *Nama:* {user.mention_html()}\n"            f"ğŸ“Œ *Username:* @{user.username if user.username else '-'}\n\n"            f"ğŸ’¬ *Chat ID:* `{chat.id}`"        )    await msg.reply_text(text, parse_mode=ParseMode.HTML)# ===== STATISTIK =====async def stats(update: Update, context: ContextTypes.DEFAULT_TYPE):    chat = update.effective_chat    chat_id = str(chat.id)    data = load_data()    try:        member_count = await chat.get_member_count()        admin_count = 0        async for member in chat.get_administrators():            admin_count += 1    except:        member_count = admin_count = 0    warns_count = len(data.get("groups", {}).get(chat_id, {}).get("warns", {}))    rep_count = len(data.get("groups", {}).get(chat_id, {}).get("reputation", {}))    autodelete_count = len(data.get("groups", {}).get(chat_id, {}).get("autodelete", []))    antilink_count = len(data.get("groups", {}).get(chat_id, {}).get("antilink_patterns", []))    antiraid_status = "âœ… Aktif" if data.get("groups", {}).get(chat_id, {}).get("antiraid", False) else "âŒ Nonaktif"        text = (        "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n"        "      ğŸ“Š *STATISTIK GRUP*    \n"        "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n"        f"ğŸ‘¥ *Anggota:* `{member_count}`\n"        f"ğŸ‘® *Admin:* `{admin_count}`\n"        f"âš ï¸ *Total Peringatan:* `{warns_count}`\n"        f"â­ *Reputasi Tercatat:* `{rep_count}`\n"        f"ğŸš« *Kata Terlarang:* `{autodelete_count}`\n"        f"ğŸ”— *Link Terblokir:* `{antilink_count}`\n"        f"ğŸ›¡ï¸ *Anti-raid:* {antiraid_status}\n"    )    keyboard = [[InlineKeyboardButton("ğŸ”„ Refresh", callback_data="refresh_stats")]]    reply_markup = InlineKeyboardMarkup(keyboard)    await update.message.reply_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)# ===== MODERASI DASAR =====@admin_onlyasync def kick(update: Update, context: ContextTypes.DEFAULT_TYPE):    if not update.message.reply_to_message:        await update.message.reply_text("âŒ *Gunakan perintah ini dengan reply ke pesan anggota.*", parse_mode=ParseMode.MARKDOWN)        return    user = update.message.reply_to_message.from_user    admin = update.message.from_user    chat = update.effective_chat    try:        await chat.ban_member(user.id)        await chat.unban_member(user.id)        await log_action(context, "Kick", user, admin)        await update.message.reply_text(f"âœ… *{user.mention_html()}* telah dikeluarkan.", parse_mode=ParseMode.HTML)    except Exception as e:        await update.message.reply_text(f"âŒ *Gagal:* `{str(e)}`", parse_mode=ParseMode.MARKDOWN)@admin_onlyasync def ban(update: Update, context: ContextTypes.DEFAULT_TYPE):    if not update.message.reply_to_message:        await update.message.reply_text("âŒ *Reply ke pesan anggota yang ingin diblokir.*", parse_mode=ParseMode.MARKDOWN)        return    user = update.message.reply_to_message.from_user    admin = update.message.from_user    chat = update.effective_chat    try:        await chat.ban_member(user.id)        await log_action(context, "Ban", user, admin)        await update.message.reply_text(f"âœ… *{user.mention_html()}* telah diblokir permanen.", parse_mode=ParseMode.HTML)    except Exception as e:        await update.message.reply_text(f"âŒ *Gagal:* `{str(e)}`", parse_mode=ParseMode.MARKDOWN)@admin_onlyasync def unban(update: Update, context: ContextTypes.DEFAULT_TYPE):    if len(context.args) == 0:        await update.message.reply_text("âŒ *Gunakan:* `/unban <user_id>`", parse_mode=ParseMode.MARKDOWN)        return    try:        user_id = int(context.args[0])        chat = update.effective_chat        admin = update.message.from_user        await chat.unban_member(user_id)        # Untuk log, kita perlu objek user, tapi kita hanya punya id. Buat dummy.        class DummyUser:            def __init__(self, uid):                self.id = uid                def mention_html(self): return f"User {uid}"        dummy = DummyUser(user_id)        await log_action(context, "Unban", dummy, admin)        await update.message.reply_text(f"âœ… *User* `{user_id}` *telah diunban.*", parse_mode=ParseMode.MARKDOWN)    except Exception as e:        await update.message.reply_text(f"âŒ *Gagal:* `{str(e)}`", parse_mode=ParseMode.MARKDOWN)@admin_onlyasync def mute(update: Update, context: ContextTypes.DEFAULT_TYPE):    if not update.message.reply_to_message:        await update.message.reply_text("âŒ *Reply ke pesan anggota yang ingin dibisukan.*", parse_mode=ParseMode.MARKDOWN)        return    user = update.message.reply_to_message.from_user    admin = update.message.from_user    chat = update.effective_chat    try:        minutes = 10        if context.args and context.args[0].isdigit():            minutes = int(context.args[0])        until_date = datetime.now() + timedelta(minutes=minutes)        await chat.restrict_member(user.id, permissions=chat.permissions, until_date=until_date)        await log_action(context, f"Mute {minutes} menit", user, admin)        await update.message.reply_text(f"ğŸ”‡ *{user.mention_html()}* dibisukan *{minutes} menit*.", parse_mode=ParseMode.HTML)    except Exception as e:        await update.message.reply_text(f"âŒ *Gagal:* `{str(e)}`", parse_mode=ParseMode.MARKDOWN)@admin_onlyasync def unmute(update: Update, context: ContextTypes.DEFAULT_TYPE):    if not update.message.reply_to_message:        await update.message.reply_text("âŒ *Reply ke pesan anggota yang ingin di-unmute.*", parse_mode=ParseMode.MARKDOWN)        return    user = update.message.reply_to_message.from_user    admin = update.message.from_user    chat = update.effective_chat    try:        await chat.restrict_member(user.id, permissions=chat.permissions, until_date=None)        await log_action(context, "Unmute", user, admin)        await update.message.reply_text(f"ğŸ”Š *{user.mention_html()}* telah di-unmute.", parse_mode=ParseMode.HTML)    except Exception as e:        await update.message.reply_text(f"âŒ *Gagal:* `{str(e)}`", parse_mode=ParseMode.MARKDOWN)# ===== SISTEM WARN =====@admin_onlyasync def warn(update: Update, context: ContextTypes.DEFAULT_TYPE):    if not update.message.reply_to_message:        await update.message.reply_text("âŒ *Reply ke pesan anggota yang ingin diperingatkan.*", parse_mode=ParseMode.MARKDOWN)        return    user = update.message.reply_to_message.from_user    admin = update.message.from_user    chat_id = str(update.effective_chat.id)    user_id = str(user.id)        data = load_data()    if chat_id not in data["groups"]:        data["groups"][chat_id] = {"warns": {}, "autodelete": [], "reputation": {}, "antilink_patterns": [], "antilink_enabled": False}    if user_id not in data["groups"][chat_id]["warns"]:        data["groups"][chat_id]["warns"][user_id] = 0    data["groups"][chat_id]["warns"][user_id] += 1    warn_count = data["groups"][chat_id]["warns"][user_id]    save_data(data)        await log_action(context, f"Warn {warn_count}/3", user, admin)        if warn_count >= 3:        try:            await update.effective_chat.ban_member(user.id)            await update.message.reply_text(f"ğŸš« *{user.mention_html()}* mencapai 3 warn dan otomatis dibanned.", parse_mode=ParseMode.HTML)            data["groups"][chat_id]["warns"][user_id] = 0            save_data(data)        except Exception as e:            await update.message.reply_text(f"âŒ *Gagal ban otomatis:* `{str(e)}`", parse_mode=ParseMode.MARKDOWN)    else:        await update.message.reply_text(f"âš ï¸ *{user.mention_html()}* mendapat warn *{warn_count}/3*.", parse_mode=ParseMode.HTML)@admin_onlyasync def warns(update: Update, context: ContextTypes.DEFAULT_TYPE):    if not update.message.reply_to_message:        await update.message.reply_text("âŒ *Reply ke pesan anggota.*", parse_mode=ParseMode.MARKDOWN)        return    user = update.message.reply_to_message.from_user    chat_id = str(update.effective_chat.id)    user_id = str(user.id)    data = load_data()    count = data.get("groups", {}).get(chat_id, {}).get("warns", {}).get(user_id, 0)    await update.message.reply_text(f"ğŸ‘¤ {user.mention_html()} memiliki *{count}* peringatan.", parse_mode=ParseMode.HTML)@admin_onlyasync def delwarn(update: Update, context: ContextTypes.DEFAULT_TYPE):    if not update.message.reply_to_message:        await update.message.reply_text("âŒ *Reply ke pesan anggota.*", parse_mode=ParseMode.MARKDOWN)        return    user = update.message.reply_to_message.from_user    admin = update.message.from_user    chat_id = str(update.effective_chat.id)    user_id = str(user.id)    data = load_data()    if chat_id in data["groups"] and user_id in data["groups"][chat_id]["warns"]:        data["groups"][chat_id]["warns"][user_id] = max(0, data["groups"][chat_id]["warns"][user_id] - 1)        save_data(data)        await log_action(context, "Hapus warn", user, admin)        await update.message.reply_text(f"âœ… 1 peringatan *{user.mention_html()}* dihapus.", parse_mode=ParseMode.HTML)    else:        await update.message.reply_text("âŒ *User tidak memiliki peringatan.*", parse_mode=ParseMode.MARKDOWN)# ===== LOCK/UNLOCK =====@admin_onlyasync def lock(update: Update, context: ContextTypes.DEFAULT_TYPE):    chat = update.effective_chat    try:        permissions = chat.permissions        new_permissions = permissions.clone(            can_send_messages=False,            can_send_media_messages=False,            can_send_polls=False,            can_send_other_messages=False,            can_add_web_page_previews=False        )        await chat.set_permissions(new_permissions)        await update.message.reply_text("ğŸ”’ *Grup terkunci.* Hanya admin yang dapat mengirim pesan.", parse_mode=ParseMode.MARKDOWN)    except Exception as e:        await update.message.reply_text(f"âŒ *Gagal mengunci:* `{str(e)}`", parse_mode=ParseMode.MARKDOWN)@admin_onlyasync def unlock(update: Update, context: ContextTypes.DEFAULT_TYPE):    chat = update.effective_chat    try:        new_permissions = chat.permissions.clone(            can_send_messages=True,            can_send_media_messages=True,            can_send_polls=True,            can_send_other_messages=True,            can_add_web_page_previews=True        )        await chat.set_permissions(new_permissions)        await update.message.reply_text("ğŸ”“ *Grup dibuka.* Semua anggota dapat mengirim pesan.", parse_mode=ParseMode.MARKDOWN)    except Exception as e:        await update.message.reply_text(f"âŒ *Gagal membuka:* `{str(e)}`", parse_mode=ParseMode.MARKDOWN)# ===== ANTI RAID =====@admin_onlyasync def antiraid(update: Update, context: ContextTypes.DEFAULT_TYPE):    if len(context.args) == 0 or context.args[0].lower() not in ['on', 'off']:        await update.message.reply_text("âŒ *Gunakan:* `/antiraid on` atau `/antiraid off`", parse_mode=ParseMode.MARKDOWN)        return    chat_id = str(update.effective_chat.id)    data = load_data()    if chat_id not in data["groups"]:        data["groups"][chat_id] = {"warns": {}, "autodelete": [], "reputation": {}, "antilink_patterns": [], "antilink_enabled": False}    data["groups"][chat_id]["antiraid"] = (context.args[0].lower() == 'on')    save_data(data)    status = "diaktifkan" if data["groups"][chat_id]["antiraid"] else "dinonaktifkan"    await update.message.reply_text(f"ğŸ›¡ï¸ *Anti-raid {status}.*", parse_mode=ParseMode.MARKDOWN)# ===== AUTO DELETE KATA =====@admin_onlyasync def autodelete(update: Update, context: ContextTypes.DEFAULT_TYPE):    if len(context.args) < 1:        await update.message.reply_text("âŒ *Gunakan:*\n/autodelete add <kata>\n/autodelete remove <kata>\n/autodelete list", parse_mode=ParseMode.MARKDOWN)        return    subcmd = context.args[0].lower()    chat_id = str(update.effective_chat.id)    data = load_data()    if chat_id not in data["groups"]:        data["groups"][chat_id] = {"warns": {}, "autodelete": [], "reputation": {}, "antilink_patterns": [], "antilink_enabled": False}        if subcmd == "add":        if len(context.args) < 2:            await update.message.reply_text("âŒ *Masukkan kata yang ingin ditambahkan.*", parse_mode=ParseMode.MARKDOWN)            return        kata = context.args[1].lower()        if kata not in data["groups"][chat_id]["autodelete"]:            data["groups"][chat_id]["autodelete"].append(kata)            save_data(data)            await update.message.reply_text(f"âœ… Kata *{kata}* ditambahkan.", parse_mode=ParseMode.MARKDOWN)        else:            await update.message.reply_text("âš ï¸ *Kata sudah ada.*", parse_mode=ParseMode.MARKDOWN)    elif subcmd == "remove":        if len(context.args) < 2:            await update.message.reply_text("âŒ *Masukkan kata yang ingin dihapus.*", parse_mode=ParseMode.MARKDOWN)            return        kata = context.args[1].lower()        if kata in data["groups"][chat_id]["autodelete"]:            data["groups"][chat_id]["autodelete"].remove(kata)            save_data(data)            await update.message.reply_text(f"âœ… Kata *{kata}* dihapus.", parse_mode=ParseMode.MARKDOWN)        else:            await update.message.reply_text("âŒ *Kata tidak ditemukan.*", parse_mode=ParseMode.MARKDOWN)    elif subcmd == "list":        daftar = data["groups"][chat_id]["autodelete"]        if daftar:            kata_list = "\n".join(f"â€¢ `{k}`" for k in daftar)            await update.message.reply_text(f"ğŸ“‹ *Daftar kata auto-delete:*\n{kata_list}", parse_mode=ParseMode.MARKDOWN)        else:            await update.message.reply_text("ğŸ“‹ *Belum ada kata.*", parse_mode=ParseMode.MARKDOWN)    else:        await update.message.reply_text("âŒ *Subperintah tidak dikenal.*", parse_mode=ParseMode.MARKDOWN)# ===== ANTI LINK =====@admin_onlyasync def antilink(update: Update, context: ContextTypes.DEFAULT_TYPE):    if len(context.args) == 0:        await update.message.reply_text("âŒ *Gunakan:*\n/antilink on/off\n/antilink add <kata>\n/antilink remove <kata>\n/antilink list", parse_mode=ParseMode.MARKDOWN)        return    subcmd = context.args[0].lower()    chat_id = str(update.effective_chat.id)    data = load_data()    if chat_id not in data["groups"]:        data["groups"][chat_id] = {"warns": {}, "autodelete": [], "reputation": {}, "antilink_patterns": [], "antilink_enabled": False}        if subcmd == "on":        data["groups"][chat_id]["antilink_enabled"] = True        save_data(data)        await update.message.reply_text("âœ… *Anti-link diaktifkan.*", parse_mode=ParseMode.MARKDOWN)    elif subcmd == "off":        data["groups"][chat_id]["antilink_enabled"] = False        save_data(data)        await update.message.reply_text("âœ… *Anti-link dinonaktifkan.*", parse_mode=ParseMode.MARKDOWN)    elif subcmd == "add":        if len(context.args) < 2:            await update.message.reply_text("âŒ *Masukkan kata/domain yang ingin diblokir.*", parse_mode=ParseMode.MARKDOWN)            return        pattern = context.args[1].lower()        if pattern not in data["groups"][chat_id]["antilink_patterns"]:            data["groups"][chat_id]["antilink_patterns"].append(pattern)            save_data(data)            await update.message.reply_text(f"âœ… *{pattern}* ditambahkan.", parse_mode=ParseMode.MARKDOWN)        else:            await update.message.reply_text("âš ï¸ *Sudah ada.*", parse_mode=ParseMode.MARKDOWN)    elif subcmd == "remove":        if len(context.args) < 2:            await update.message.reply_text("âŒ *Masukkan kata/domain yang ingin dihapus.*", parse_mode=ParseMode.MARKDOWN)            return        pattern = context.args[1].lower()        if pattern in data["groups"][chat_id]["antilink_patterns"]:            data["groups"][chat_id]["antilink_patterns"].remove(pattern)            save_data(data)            await update.message.reply_text(f"âœ… *{pattern}* dihapus.", parse_mode=ParseMode.MARKDOWN)        else:            await update.message.reply_text("âŒ *Tidak ditemukan.*", parse_mode=ParseMode.MARKDOWN)    elif subcmd == "list":        patterns = data["groups"][chat_id].get("antilink_patterns", [])        if patterns:            list_text = "\n".join(f"â€¢ `{p}`" for p in patterns)            await update.message.reply_text(f"ğŸ“‹ *Daftar link terblokir:*\n{list_text}", parse_mode=ParseMode.MARKDOWN)        else:            await update.message.reply_text("ğŸ“‹ *Belum ada.*", parse_mode=ParseMode.MARKDOWN)    else:        await update.message.reply_text("âŒ *Subperintah tidak dikenal.*", parse_mode=ParseMode.MARKDOWN)# ===== REMINDER =====@admin_onlyasync def remind(update: Update, context: ContextTypes.DEFAULT_TYPE):    if len(context.args) < 2:        await update.message.reply_text("âŒ *Gunakan:* `/remind <waktu> <pesan>`\nContoh: `/remind 10m Rapat grup`", parse_mode=ParseMode.MARKDOWN)        return    time_str = context.args[0]    message = " ".join(context.args[1:])    match = re.match(r"(\d+)([mhd])", time_str)    if not match:        await update.message.reply_text("âŒ *Format waktu salah. Gunakan angka + m (menit), h (jam), d (hari).*", parse_mode=ParseMode.MARKDOWN)        return    amount = int(match.group(1))    unit = match.group(2)    now = datetime.now()    if unit == 'm':        delta = timedelta(minutes=amount)    elif unit == 'h':        delta = timedelta(hours=amount)    elif unit == 'd':        delta = timedelta(days=amount)    else:        return    reminder_time = now + delta    data = load_data()    data["reminders"].append({        "chat_id": update.effective_chat.id,        "time": reminder_time.timestamp(),        "message": message    })    save_data(data)    context.job_queue.run_once(send_reminder, delta, chat_id=update.effective_chat.id, name=message, data={"chat_id": update.effective_chat.id, "message": message})    await update.message.reply_text(f"âœ… *Reminder disetel pada* `{reminder_time.strftime('%H:%M %d/%m')}`", parse_mode=ParseMode.MARKDOWN)async def send_reminder(context: ContextTypes.DEFAULT_TYPE):    job = context.job    await context.bot.send_message(chat_id=job.chat_id, text=f"â° *Reminder:* {job.data['message']}", parse_mode=ParseMode.MARKDOWN)async def check_reminders(context: ContextTypes.DEFAULT_TYPE):    data = load_data()    now = datetime.now().timestamp()    new_reminders = []    for rem in data["reminders"]:        if rem["time"] <= now:            try:                await context.bot.send_message(chat_id=rem["chat_id"], text=f"â° *Reminder:* {rem['message']}", parse_mode=ParseMode.MARKDOWN)            except:                pass        else:            new_reminders.append(rem)    data["reminders"] = new_reminders    save_data(data)# ===== POLLING =====@admin_onlyasync def poll(update: Update, context: ContextTypes.DEFAULT_TYPE):    if len(context.args) == 0:        await update.message.reply_text("âŒ *Gunakan:* `/poll Pertanyaan | Opsi1 | Opsi2 | ...`", parse_mode=ParseMode.MARKDOWN)        return    text = " ".join(context.args)    parts = [p.strip() for p in text.split("|")]    if len(parts) < 3:        await update.message.reply_text("âŒ *Setidaknya harus ada 2 opsi.*", parse_mode=ParseMode.MARKDOWN)        return    question = parts[0]    options = parts[1:]    if len(options) > 10:        await update.message.reply_text("âŒ *Maksimal 10 opsi.*", parse_mode=ParseMode.MARKDOWN)        return    await update.message.reply_poll(question, options, is_anonymous=False)# ===== REPUTASI =====@admin_onlyasync def rep(update: Update, context: ContextTypes.DEFAULT_TYPE):    if not update.message.reply_to_message:        await update.message.reply_text("âŒ *Reply ke pesan user.*", parse_mode=ParseMode.MARKDOWN)        return    if len(context.args) == 0:        await update.message.reply_text("âŒ *Gunakan:* `/rep @user +5` atau `/rep @user -2`", parse_mode=ParseMode.MARKDOWN)        return    user = update.message.reply_to_message.from_user    admin = update.message.from_user    chat_id = str(update.effective_chat.id)    user_id = str(user.id)    try:        change = int(context.args[0])    except:        await update.message.reply_text("âŒ *Nilai harus angka, misal +5 atau -2*", parse_mode=ParseMode.MARKDOWN)        return    data = load_data()    if chat_id not in data["groups"]:        data["groups"][chat_id] = {"warns": {}, "autodelete": [], "reputation": {}, "antilink_patterns": [], "antilink_enabled": False}    if user_id not in data["groups"][chat_id]["reputation"]:        data["groups"][chat_id]["reputation"][user_id] = 0    data["groups"][chat_id]["reputation"][user_id] += change    new_rep = data["groups"][chat_id]["reputation"][user_id]    save_data(data)    await log_action(context, f"Ubah reputasi {change:+d}", user, admin)    await update.message.reply_text(f"âœ… Reputasi *{user.mention_html()}* sekarang *{new_rep}* (perubahan {change:+d}).", parse_mode=ParseMode.HTML)async def reputation(update: Update, context: ContextTypes.DEFAULT_TYPE):    if update.message.reply_to_message:        user = update.message.reply_to_message.from_user    else:        user = update.effective_user    chat_id = str(update.effective_chat.id)    user_id = str(user.id)    data = load_data()    rep = data.get("groups", {}).get(chat_id, {}).get("reputation", {}).get(user_id, 0)    await update.message.reply_text(f"ğŸ‘¤ {user.mention_html()} memiliki reputasi *{rep}* poin.", parse_mode=ParseMode.HTML)# ===== EKSPOR =====@admin_onlyasync def export(update: Update, context: ContextTypes.DEFAULT_TYPE):    chat = update.effective_chat    chat_id = str(chat.id)    data = load_data()    group_data = data.get("groups", {}).get(chat_id, {})    text = f"ğŸ“Š *Ekspor Data Grup*\n\n"    text += f"*Nama Grup:* {chat.title}\n"    text += f"*ID Grup:* {chat_id}\n"    text += f"*Jumlah Anggota:* {await chat.get_member_count()}\n\n"    text += "*Daftar Peringatan:*\n"    for uid, count in group_data.get("warns", {}).items():        try:            user = await chat.get_member(int(uid))            name = user.user.full_name        except:            name = f"ID:{uid}"        text += f"â€¢ {name}: {count} warn\n"    text += "\n*Daftar Reputasi:*\n"    for uid, rep in group_data.get("reputation", {}).items():        try:            user = await chat.get_member(int(uid))            name = user.user.full_name        except:            name = f"ID:{uid}"        text += f"â€¢ {name}: {rep} poin\n"    filename = f"export_{chat_id}.txt"    with open(filename, "w") as f:        f.write(text)    with open(filename, "rb") as f:        await update.message.reply_document(document=f, filename=f"grup_{chat.username or chat_id}.txt", caption="ğŸ“ *Data grup berhasil diekspor.*", parse_mode=ParseMode.MARKDOWN)    os.remove(filename)# ===== ANTI SPAM & AUTO DELETE =====async def anti_flood(update: Update, context: ContextTypes.DEFAULT_TYPE):    if not update.message or not update.message.from_user:        return    user_id = update.message.from_user.id    chat_id = update.effective_chat.id    try:        member = await update.effective_chat.get_member(user_id)        if member.status in ['administrator', 'creator']:            return    except:        pass    if 'flood' not in context.bot_data:        context.bot_data['flood'] = {}    if chat_id not in context.bot_data['flood']:        context.bot_data['flood'][chat_id] = {}    if user_id not in context.bot_data['flood'][chat_id]:        context.bot_data['flood'][chat_id][user_id] = []    now = datetime.now()    context.bot_data['flood'][chat_id][user_id] = [t for t in context.bot_data['flood'][chat_id][user_id] if (now - t).seconds < 5]    context.bot_data['flood'][chat_id][user_id].append(now)    if len(context.bot_data['flood'][chat_id][user_id]) > 8:        try:            await update.message.delete()            await update.effective_chat.restrict_member(user_id, permissions=update.effective_chat.permissions, until_date=datetime.now()+timedelta(minutes=5))            await context.bot.send_message(chat_id, f"â›” *{update.message.from_user.mention_html()}* terkena mute 5 menit karena spam.", parse_mode=ParseMode.HTML)        except:            passasync def auto_delete_check(update: Update, context: ContextTypes.DEFAULT_TYPE):    if not update.message or not update.message.text or not update.message.from_user:        return    chat_id = str(update.effective_chat.id)    user = update.message.from_user    try:        member = await update.effective_chat.get_member(user.id)        if member.status in ['administrator', 'creator']:            return    except:        return    data = load_data()    if chat_id not in data["groups"]:        return    banned_words = data["groups"][chat_id].get("autodelete", [])    if not banned_words:        return    text = update.message.text.lower()    for word in banned_words:        if word in text:            try:                await update.message.delete()                warn_msg = await update.effective_chat.send_message(f"âš ï¸ *{user.mention_html()}*, pesan Anda dihapus karena mengandung kata terlarang.", parse_mode=ParseMode.HTML)                context.job_queue.run_once(lambda ctx: ctx.bot.delete_message(chat_id=update.effective_chat.id, message_id=warn_msg.message_id), 5)            except:                pass            breakasync def anti_link_check(update: Update, context: ContextTypes.DEFAULT_TYPE):    if not update.message or not update.message.text or not update.message.from_user:        return    chat_id = str(update.effective_chat.id)    user = update.message.from_user    data = load_data()    group_data = data.get("groups", {}).get(chat_id, {})    if not group_data.get("antilink_enabled", False):        return    try:        member = await update.effective_chat.get_member(user.id)        if member.status in ['administrator', 'creator']:            return    except:        return    patterns = group_data.get("antilink_patterns", [])    if not patterns:        return    text = update.message.text    if 'http://' not in text and 'https://' not in text and 't.me/' not in text and 'www.' not in text:        return    text_lower = text.lower()    for pattern in patterns:        if pattern in text_lower:            try:                await update.message.delete()                warn_msg = await update.effective_chat.send_message(f"ğŸš« *{user.mention_html()}*, pesan Anda mengandung link yang diblokir dan telah dihapus.", parse_mode=ParseMode.HTML)                context.job_queue.run_once(lambda ctx: ctx.bot.delete_message(chat_id=update.effective_chat.id, message_id=warn_msg.message_id), 5)            except:                pass            break# ===== WELCOME & LEAVE =====async def welcome_new_member(update: Update, context: ContextTypes.DEFAULT_TYPE):    for member in update.message.new_chat_members:        if member.id == context.bot.id:            await update.message.reply_text("ğŸ¤– *Halo! Saya bot penjaga grup.* Jadikan saya admin untuk fitur lengkap.", parse_mode=ParseMode.MARKDOWN)        else:            welcome_text = f"ğŸ‰ *Selamat datang* {member.mention_html()} *di grup!* Baca aturan dan perkenalkan diri."            msg = await update.message.reply_text(welcome_text, parse_mode=ParseMode.HTML)            context.job_queue.run_once(lambda ctx: ctx.bot.delete_message(chat_id=update.effective_chat.id, message_id=msg.message_id), 60)async def left_member(update: Update, context: ContextTypes.DEFAULT_TYPE):    if update.message.left_chat_member:        user = update.message.left_chat_member        await update.message.reply_text(f"ğŸ‘‹ *{user.mention_html()}* meninggalkan grup.", parse_mode=ParseMode.HTML)# ===== CALLBACK QUERY =====async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):    query = update.callback_query    await query.answer()    if query.data == "help":        await help_command(update, context)    elif query.data == "stats":        await stats(update, context)    elif query.data == "refresh_stats":        await stats(update, context)    elif query.data == "admin_menu":        text = (            "ğŸ‘‘ *Menu Admin*\n\n"            "â€¢ /kick â€“ Keluarkan anggota\n"            "â€¢ /ban â€“ Blokir permanen\n"            "â€¢ /mute â€“ Bisukan\n"            "â€¢ /warn â€“ Beri peringatan\n"            "â€¢ /lock â€“ Kunci grup\n"            "â€¢ /antiraid â€“ Proteksi raid\n"            "â€¢ /autodelete â€“ Atur kata terlarang\n"            "â€¢ /antilink â€“ Atur blokir link\n"            "â€¢ /remind â€“ Set pengingat\n"            "â€¢ /poll â€“ Buat polling\n"            "â€¢ /rep â€“ Kelola reputasi\n"            "â€¢ /export â€“ Ekspor data\n"        )        await query.edit_message_text(text, parse_mode=ParseMode.MARKDOWN)# ===== OWNER COMMANDS =====@owner_onlyasync def shutdown(update: Update, context: ContextTypes.DEFAULT_TYPE):    await update.message.reply_text("ğŸ›‘ *Bot dimatikan...*", parse_mode=ParseMode.MARKDOWN)    context.application.stop()    import sys    sys.exit(0)@owner_onlyasync def broadcast(update: Update, context: ContextTypes.DEFAULT_TYPE):    await update.message.reply_text("ğŸ“¢ *Fitur broadcast sedang dikembangkan.*", parse_mode=ParseMode.MARKDOWN)# ===== MAIN =====def main():    application = Application.builder().token(TOKEN).build()    # Command handlers    application.add_handler(CommandHandler("start", start))    application.add_handler(CommandHandler("help", help_command))    application.add_handler(CommandHandler("id", id_command))    application.add_handler(CommandHandler("kick", kick))    application.add_handler(CommandHandler("ban", ban))    application.add_handler(CommandHandler("unban", unban))    application.add_handler(CommandHandler("mute", mute))    application.add_handler(CommandHandler("unmute", unmute))    application.add_handler(CommandHandler("warn", warn))    application.add_handler(CommandHandler("warns", warns))    application.add_handler(CommandHandler("delwarn", delwarn))    application.add_handler(CommandHandler("lock", lock))    application.add_handler(CommandHandler("unlock", unlock))    application.add_handler(CommandHandler("antiraid", antiraid))    application.add_handler(CommandHandler("autodelete", autodelete))    application.add_handler(CommandHandler("antilink", antilink))    application.add_handler(CommandHandler("remind", remind))    application.add_handler(CommandHandler("poll", poll))    application.add_handler(CommandHandler("rep", rep))    application.add_handler(CommandHandler("reputation", reputation))    application.add_handler(CommandHandler("export", export))    application.add_handler(CommandHandler("stats", stats))    application.add_handler(CommandHandler("shutdown", shutdown))    application.add_handler(CommandHandler("broadcast", broadcast))    # Message handlers    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, auto_delete_check))    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, anti_link_check))    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, anti_flood))    application.add_handler(MessageHandler(filters.StatusUpdate.NEW_CHAT_MEMBERS, welcome_new_member))    application.add_handler(MessageHandler(filters.StatusUpdate.LEFT_CHAT_MEMBER, left_member))    # Callback    application.add_handler(CallbackQueryHandler(button_callback))    # Job queue untuk reminder    application.job_queue.run_repeating(check_reminders, interval=60, first=10)    print("ğŸ¤– Bot guard grup berjalan... Tekan Ctrl+C untuk stop.")    application.run_polling(allowed_updates=Update.ALL_TYPES)if __name__ == "__main__":    main()